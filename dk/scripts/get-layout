#!/bin/bash
# Get current dk layout with icon

# Check if dkcmd exists
if ! command -v dkcmd &> /dev/null; then
    echo "󰙀"  # Default icon if dk not running
    exit 0
fi

# Get status and check if dk is responding
status=$(dkcmd status type=ws 2>/dev/null)
if [ -z "$status" ]; then
    echo "󰙀"  # Default icon if no response
    exit 0
fi

# Try to extract layout - multiple methods for robustness
layout=$(echo "$status" | awk '
    /"focused":true/ {
        while (getline && !/^\s*\}/) {
            if (/"layout"/) {
                gsub(/.*"layout":\s*"/, "")
                gsub(/".*/, "")
                print
                exit
            }
        }
    }
')

# If still empty, try simpler grep approach
if [ -z "$layout" ]; then
    layout=$(echo "$status" | grep -A5 '"focused":true' | grep -oP '"layout":\s*"\K[^"]+' | head -1)
fi

# Map layouts to icons
case "$layout" in
    "tile")    echo "󰙀" ;;      # Tile icon
    "rtile")   echo "󱒅" ;;      # Right tile icon  
    "mono")    echo "󱟱" ;;      # Monocle/fullscreen icon
    "grid")    echo "󰓰" ;;      # Grid icon
    "spiral")  echo "󱒋" ;;      # Spiral icon
    "dwindle") echo "󱒌" ;;      # Dwindle icon
    "none")    echo "󰖲" ;;      # Floating icon
    *)         echo "󰙀" ;;      # Default to tile icon
esac